<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Zip Clock - Advanced Command Center</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      :root {
        --bg-color: #f6f7ff;
        --nav-navy: #001d3d;
        --accent-blue: #1e62ff;
        --settings-blue: #5ea3f5;
        --sidebar-collapsed: 60px;
        --sidebar-expanded: 240px;
        --text-dim: #b0b8c1;
        --border-color: #e5e7eb;
        --success: #10b981;
        --danger: #ef4444;
        --warning: #f59e0b;
        --info-blue: #3b82f6;
        --ai-purple: #8b5cf6;
      }
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Roboto", sans-serif;
      }
      body {
        background-color: var(--bg-color);
        overflow-x: hidden;
        color: #374151;
      }
      /* --- Header --- */
      header {
        height: 50px;
        background-color: var(--nav-navy);
        display: grid;
        grid-template-columns: 1fr auto 1fr;
        align-items: center;
        padding: 0 15px;
        color: white;
        position: fixed;
        top: 0;
        width: 100%;
        z-index: 1000;
      }
      .header-left {
        display: flex;
        align-items: center;
        gap: 18px;
      }
      .app-logo {
        width: 28px;
        height: 28px;
      }
      .nav-link {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 13px;
        color: #d1d5db;
        cursor: pointer;
      }
      .header-center {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .weather {
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 14px;
      }
      .time-box {
        display: flex;
        align-items: baseline;
        gap: 4px;
        font-size: 14px;
      }
      .header-right {
        display: flex;
        align-items: center;
        justify-content: flex-end;
        gap: 15px;
      }
      .store-tag {
        background: rgba(255, 255, 255, 0.15);
        padding: 3px 10px;
        border-radius: 15px;
        font-size: 12px;
      }
      /* --- Sidebar --- */
      .sidebar {
        width: var(--sidebar-collapsed);
        background-color: var(--nav-navy);
        height: calc(100vh - 50px);
        position: fixed;
        top: 50px;
        left: 0;
        transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        overflow: hidden;
        z-index: 999;
        display: flex;
        flex-direction: column;
      }
      .sidebar:hover {
        width: var(--sidebar-expanded);
      }
      .menu-list {
        list-style: none;
        flex-grow: 1;
        padding-top: 5px;
      }
      .menu-item {
        display: flex;
        align-items: center;
        height: 44px;
        padding: 0 18px;
        color: var(--text-dim);
        text-decoration: none;
        white-space: nowrap;
      }
      .menu-item.active {
        border-left: 3px solid #3b82f6;
        background: #1a3557;
        color: white;
      }
      .menu-label {
        margin-left: 15px;
        font-size: 13px;
        opacity: 0;
        transition: opacity 0.2s;
      }
      .sidebar:hover .menu-label {
        opacity: 1;
      }
      .sidebar-footer {
        width: 100%;
        padding-bottom: 20px;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        padding-left: 14px;
        gap: 15px;
      }
      .settings-circle {
        width: 32px;
        height: 32px;
        background-color: var(--settings-blue);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        cursor: pointer;
      }
      .help-main {
        width: 32px;
        height: 32px;
        background-color: var(--accent-blue);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 10px;
        font-weight: 800;
        cursor: pointer;
      }
      /* --- Main Content --- */
      .main-content {
        margin-left: var(--sidebar-collapsed);
        padding: 70px 20px 20px 20px;
      }
      /* --- KPI Dashboard --- */
      .kpi-row {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 15px;
        margin-bottom: 25px;
      }
      .kpi-card {
        background: white;
        border-radius: 12px;
        padding: 12px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        border: 1px solid #f0f2f5;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        min-height: 135px;
      }
      .kpi-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }
      .kpi-title-group {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .kpi-icon-box {
        width: 28px;
        height: 28px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
      }
      .kpi-name {
        font-size: 12px;
        font-weight: 500;
        color: #64748b;
      }
      .kpi-mini-graph {
        color: var(--success);
        font-size: 16px;
        cursor: pointer;
        padding: 4px;
        border-radius: 4px;
      }
      .kpi-number {
        font-size: 22px;
        font-weight: 700;
        color: #1e293b;
        display: block;
      }
      .kpi-badge {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        font-size: 10px;
        font-weight: 600;
        padding: 2px 8px;
        border-radius: 12px;
        margin-top: 4px;
      }
      .badge-pos {
        background: #ecfdf5;
        color: #10b981;
      }
      .badge-neg {
        background: #fef2f2;
        color: #ef4444;
      }
      .kpi-footer {
        display: grid;
        grid-template-columns: 1fr 1fr;
        border-top: 1px solid #f1f5f9;
        padding-top: 8px;
        margin-top: 8px;
      }
      .footer-item {
        display: flex;
        flex-direction: column;
      }
      .footer-item:first-child {
        border-right: 1px solid #f1f5f9;
        padding-right: 8px;
      }
      .footer-item:last-child {
        padding-left: 8px;
      }
      .footer-label {
        font-size: 9px;
        text-transform: uppercase;
        color: #94a3b8;
        font-weight: 700;
        letter-spacing: 0.3px;
      }
      .footer-value {
        font-size: 11px;
        font-weight: 700;
        color: #334155;
      }
      /* --- Tool Bar --- */
      .tool-bar {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        margin-bottom: 15px;
      }
      .btn-advanced {
        background: white;
        border: 1px solid var(--border-color);
        padding: 8px 16px;
        border-radius: 8px;
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .btn-intel {
        background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
        color: white;
        border: none;
      }
      /* --- Status Tabs --- */
      .status-row {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 12px;
        margin-bottom: 15px;
      }
      .status-tab {
        padding: 14px 20px;
        border-radius: 10px;
        color: white;
        cursor: pointer;
        transition: 0.2s;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.25);
      }
      .status-tab.active {
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.18);
        border: 1px solid rgba(255, 255, 255, 0.6);
      }
      .tab-clocked {
        background: #3b82f6;
      }
      .tab-break {
        background: #60a5fa;
      }
      .tab-missing {
        background: #f87171;
      }
      /* --- Table --- */
      .table-wrap {
        background: white;
        border-radius: 8px;
        border: 1px solid var(--border-color);
        overflow: hidden;
      }
      .table-header {
        padding: 12px 15px;
        border-bottom: 1px solid #f1f5f9;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .search-box {
        position: relative;
      }
      .search-box input {
        padding: 6px 10px 6px 30px;
        border-radius: 6px;
        border: 1px solid #e2e8f0;
        font-size: 12px;
        width: 250px;
        outline: none;
      }
      .search-box i {
        position: absolute;
        left: 10px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 12px;
        color: #94a3b8;
      }
      table {
        table-layout: fixed; /* This is the most important property */
        width: 100%;
      }
      th:first-child,
      td:first-child {
        width: 250px; /* Adjust this number to match your screenshot exactly */
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      /* Let the other columns auto-adjust or set them to a fixed small width */
      th:not(:first-child),
      td:not(:first-child) {
        width: 80px;
      }
      th {
        padding: 10px 12px;
        background: #f8fafc;
        color: #64748b;
        font-weight: 600;
        text-align: left;
        border-bottom: 1px solid #edf2f7;
        text-transform: uppercase;
        font-size: 10px;
      }
      td {
        padding: 10px 12px;
        border-bottom: 1px solid #f8fafc;
        vertical-align: middle;
      }
      .emp-profile {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .avatar {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 11px;
      }
      /* --- MODAL SYSTEM --- */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.4);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 2000;
        backdrop-filter: blur(2px);
      }
      .modal-content {
        background: white;
        width: 850px;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 20px 25px rgba(0, 0, 0, 0.15);
      }
      .modal-header {
        padding: 15px 20px;
        background: var(--nav-navy);
        color: white;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .modal-tabs {
        display: flex;
        background: #f1f5f9;
        border-bottom: 1px solid #e2e8f0;
      }
      .modal-tab {
        padding: 12px 20px;
        font-size: 12px;
        font-weight: 600;
        color: #64748b;
        cursor: pointer;
        border-bottom: 2px solid transparent;
      }
      .modal-tab.active {
        color: var(--accent-blue);
        border-bottom-color: var(--accent-blue);
        background: white;
      }
      .modal-body {
        padding: 20px;
        min-height: 400px;
        max-height: 550px;
        overflow-y: auto;
      }
      /* Icons */
      .status-cell {
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 20px;
      }
      .icon-green-smile {
        color: #10b981;
      }
      .icon-orange-straight {
        color: #f59e0b;
      }
      .icon-orange-sad {
        color: #f59e0b;
        opacity: 0.8;
      }
      .icon-red-sad {
        color: #ef4444;
      }
      .icon-blue-question {
        color: #3b82f6;
      }
      .icon-grey-empty {
        color: #cbd5e1;
      }
      .timer-badge-red {
        border: 2px solid #ef4444;
        color: #ef4444;
        width: 22px;
        height: 22px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
        font-weight: 700;
      }
      /* Special Intelligence Center Styles */
      .intel-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }
      .intel-card {
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        border-radius: 10px;
        padding: 15px;
      }
      .insight-item {
        border-left: 3px solid var(--ai-purple);
        background: #fff;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 4px;
        font-size: 12px;
      }
      /* Update Modal for Carbon Copy Look */
      .modal-content {
        width: 900px;
        border-radius: 16px;
        border: none;
      }
      .modal-header {
        background: #f8fafc;
        color: #1e293b;
        padding: 20px;
        border-bottom: 1px solid #e2e8f0;
      }
      .modal-tabs {
        background: white;
        padding: 10px 20px;
        gap: 10px;
        border-bottom: 1px solid #f1f5f9;
      }
      .modal-tab {
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        padding: 6px 16px;
        display: flex;
        align-items: center;
        gap: 6px;
        transition: 0.2s;
      }
      .modal-tab.active {
        background: #2563eb;
        color: white;
        border-color: #2563eb;
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
      }
      /* Table & Insight Styles */
      .status-pill {
        padding: 2px 10px;
        border-radius: 12px;
        font-size: 10px;
        font-weight: 700;
      }
      .pill-low {
        background: #dcfce7;
        color: #15803d;
      }
      .pill-normal {
        background: #f1f5f9;
        color: #64748b;
      }
      .pill-peak {
        background: #fee2e2;
        color: #b91c1c;
      }
      .ai-report-card {
        border: 1px solid #e2e8f0;
        border-radius: 12px;
        padding: 20px;
        background: white;
      }
      .recommendation-box {
        background: #fffbeb;
        border: 1px solid #fef3c7;
        border-radius: 8px;
        padding: 15px;
        margin-top: 15px;
        display: flex;
        gap: 12px;
      }
      /* Premium Intelligence Center Overrides */
      .intel-card {
        background: #ffffff;
        border: 1px solid #f1f5f9;
        border-radius: 16px;
        padding: 20px;
        box-shadow:
          0 4px 6px -1px rgba(0, 0, 0, 0.05),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
      }
      .insight-item {
        border-left: 4px solid var(--ai-purple);
        background: #f8fafc;
        padding: 12px 16px;
        margin-bottom: 12px;
        border-radius: 0 12px 12px 0;
        font-size: 13px;
        transition: transform 0.2s;
      }
      .insight-item:hover {
        transform: translateX(5px);
        background: #f1f5f9;
      }
      .modal-tab {
        border: none !important;
        background: transparent;
        font-weight: 500;
        color: #64748b;
        padding: 8px 20px;
        border-radius: 20px !important;
        transition: all 0.3s ease;
      }
      .modal-tab.active {
        background: #2563eb !important;
        color: white !important;
        box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.3);
      }
      .premium-icon-box {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 15px;
        font-size: 20px;
      }
      .premium-popover {
        position: absolute;
        width: 320px;
        background: white;
        border-radius: 16px;
        box-shadow:
          0 20px 25px -5px rgba(0, 0, 0, 0.1),
          0 10px 10px -5px rgba(0, 0, 0, 0.04);
        border: 1px solid #e2e8f0;
        overflow: hidden;
        animation: popIn 0.2s ease-out;
      }
      @keyframes popIn {
        from {
          opacity: 0;
          transform: scale(0.95) translateY(10px);
        }
        to {
          opacity: 1;
          transform: scale(1) translateY(0);
        }
      }
      .pop-header {
        padding: 16px;
        border-bottom: 1px solid #f1f5f9;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
      }
      .pop-body {
        padding: 16px;
      }
      .shift-progress-container {
        margin-bottom: 20px;
      }
      .progress-track {
        height: 6px;
        background: #f1f5f9;
        border-radius: 3px;
        overflow: hidden;
      }
      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #3b82f6, #60a5fa);
        border-radius: 3px;
      }
      .pop-stats-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        margin-bottom: 20px;
      }
      .pop-stat-item {
        background: #f8fafc;
        padding: 10px;
        border-radius: 8px;
      }
      .pop-stat-item label {
        display: block;
        font-size: 9px;
        font-weight: 800;
        color: #94a3b8;
        margin-bottom: 4px;
      }
      .pop-stat-item value {
        display: block;
        font-size: 13px;
        font-weight: 700;
        color: #1e293b;
      }
      .pop-actions {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
      }
      .pop-btn {
        border: none;
        padding: 10px;
        border-radius: 8px;
        font-size: 11px;
        font-weight: 700;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        transition: 0.2s;
      }
      .btn-break {
        background: #eff6ff;
        color: #2563eb;
      }
      .btn-clockout {
        background: #fff1f2;
        color: #e11d48;
      }
      .pop-btn:hover {
        filter: brightness(0.95);
      }
      .pop-icon-btn {
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        padding: 8px;
        border-radius: 8px;
        color: #64748b;
        cursor: pointer;
        transition: 0.2s;
      }
      .pop-icon-btn:hover {
        background: #f1f5f9;
        color: #1e293b;
      }
      .compact-popover {
        background: white;
        width: 480px;
        border-radius: 8px;
        border: 1px solid #d1d5db;
        position: relative;
        font-size: 12px;
        color: #374151;
      }
      .pop-header-compact {
        padding: 10px 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 16px;
        font-weight: 500;
      }
      .pop-header-compact i {
        font-size: 14px;
        cursor: pointer;
        color: #6b7280;
      }
      .pop-grid-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        padding: 10px 15px;
        background: #fff;
      }
      .border-bottom {
        border-bottom: 1px solid #e5e7eb;
        border-top: 1px solid #e5e7eb;
      }
      .pop-field label {
        color: #4b5563;
        font-weight: 400;
        margin-right: 5px;
      }
      .pop-field span {
        font-weight: 400;
      }
      .pop-action-row {
        padding: 15px;
        display: flex;
        gap: 80px;
        justify-content: flex-start;
      }
      .suggest-btn {
        background: #4dd0ff;
        color: white;
        border: none;
        padding: 6px 20px;
        border-radius: 20px;
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
      }
      .pop-data-grid {
        display: grid;
        grid-template-columns: 1.2fr 1fr;
        padding: 0 15px 15px 15px;
        row-gap: 4px;
      }
      .pop-field-sm {
        display: flex;
        justify-content: space-between;
        padding-right: 20px;
      }
      .pop-field-sm label {
        font-size: 11px;
        color: #4b5563;
      }
      .pop-field-sm span {
        font-size: 11px;
        font-weight: 500;
      }
      #emp-popover-container {
        position: absolute;
        z-index: 3000;
        overflow: visible; /* CRITICAL: Prevents the arrow from being cut off */
      }
      .modern-popover {
        background: #ffffff;
        width: 480px; /* Kept to your requested size */
        border-radius: 12px;
        border: 1px solid #e2e8f0;
        box-shadow:
          0 10px 25px -5px rgba(0, 0, 0, 0.1),
          0 8px 10px -6px rgba(0, 0, 0, 0.1);
        position: relative;
        font-family: "Inter", sans-serif;
        overflow: hidden;
      }
      .pop-arrow {
        position: absolute;
        left: -8px; /* Moves arrow slightly outside the box border */
        top: 24px; /* Aligns with the middle of the name text */
        width: 0;
        height: 0;
        border-top: 8px solid transparent;
        border-bottom: 8px solid transparent;
        border-right: 8px solid #ffffff; /* Matches the popover background */
        filter: drop-shadow(
          -1px 0 0px rgba(0, 0, 0, 0.1)
        ); /* Adds slight definition to the tip */
        z-index: 3001;
      }
      .pop-header-main {
        padding: 12px 16px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .emp-name-title {
        font-size: 16px;
        font-weight: 700;
        color: #1e293b;
      }
      .close-pop-btn {
        border: none;
        background: transparent;
        color: #94a3b8;
        cursor: pointer;
        padding: 4px;
        transition: color 0.2s;
      }
      .close-pop-btn:hover {
        color: #475569;
      }
      .pop-sub-header {
        display: grid;
        grid-template-columns: 1fr 1fr;
        padding: 10px 16px;
        background: #fdfdfd;
        border-top: 1px solid #f1f5f9;
        border-bottom: 1px solid #f1f5f9;
      }
      .info-group label {
        font-size: 11px;
        color: #64748b;
        font-weight: 500;
        margin-right: 4px;
      }
      .info-group span {
        font-size: 12px;
        color: #334155;
        font-weight: 500;
      }
      .pop-action-container {
        padding: 16px;
        display: flex;
        gap: 12px;
      }
      .action-pill {
        border: none;
        padding: 6px 18px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        color: white;
        cursor: pointer;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }
      .pill-cyan {
        background: #4dd0ff;
      }
      .pill-blue {
        background: #3b82f6;
      }
      .pop-metrics-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        padding: 0 16px 16px 16px;
        column-gap: 24px;
        row-gap: 6px;
      }
      .metric-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .metric-item label {
        font-size: 11px;
        color: #475569;
        font-weight: 400;
      }
      .metric-item span {
        font-size: 11px;
        font-weight: 600;
        color: #1e293b;
      }
      .time-loss-fullscreen {
        width: 100%;
        height: calc(100vh - 70px); /* header height adjustment */
        background: #f6f7ff;
        overflow: auto;
      }
      .time-loss-fullscreen img {
        width: 100%;
        height: auto;
        display: block;
      }
      .main-content.no-padding {
        padding: 70px 0 0 0;
      }

      /* --- Mobile Specific Overrides --- */
      @media (max-width: 768px) {
        /* 1. Header: Simplify for small screens */
        .header-center {
          display: none;
        }
        header {
          grid-template-columns: 1fr auto;
        }

        /* 2. Sidebar to Bottom Nav: Ideal for thumb-reach */
        .sidebar {
          width: 100% !important;
          height: 60px;
          top: auto;
          bottom: 0;
          flex-direction: row;
          border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        .sidebar:hover {
          width: 100% !important;
        }
        .menu-list {
          display: flex;
          width: 100%;
          justify-content: space-around;
          padding-top: 0;
        }
        .menu-item {
          flex-direction: column;
          height: 60px;
          padding: 10px 0;
          flex: 1;
          gap: 2px;
        }
        .menu-item i {
          margin: 0;
          font-size: 18px;
        }
        .menu-label {
          opacity: 1 !important;
          font-size: 9px;
          margin: 0;
        }
        .sidebar-footer {
          display: none;
        }

        /* 3. Main Content: Adjust padding for bottom nav */
        .main-content {
          margin-left: 0 !important;
          padding: 65px 12px 80px 12px;
        }

        /* 4. KPI Grid: 2-column layout */
        .kpi-row {
          grid-template-columns: repeat(2, 1fr);
          gap: 10px;
        }
        .kpi-card {
          min-height: 120px;
        }
        .kpi-number {
          font-size: 18px;
        }

        /* 5. Status Tabs: Stack them */
        .status-row {
          grid-template-columns: 1fr;
        }

        /* 6. Table to Card Layout: Prevents horizontal scrolling */
        .table-wrap {
          border: none;
          background: transparent;
        }
        table thead {
          display: none;
        } /* Hide headers */

        table,
        tbody,
        tr,
        td {
          display: block;
          width: 100% !important;
        }

        tr {
          background: white;
          margin-bottom: 12px;
          border-radius: 12px;
          border: 1px solid #e2e8f0;
          padding: 12px;
        }

        td {
          border: none;
          padding: 4px 0;
          text-align: left;
        }

        /* Move icons to a scrollable row inside the card */
        td:not(:first-child) {
          display: inline-block;
          width: auto !important;
          margin-right: 15px;
        }

        /* 7. Modal & Popover: Full width */
        .modal-content {
          width: 95%;
        }
        .modern-popover {
          width: 300px; /* Narrower for mobile */
          left: 50% !important;
          transform: translateX(-50%);
        }
        .pop-arrow {
          display: none;
        } /* Remove arrow for centered popover */
      }
    </style>
  </head>
  <body>
    <header>
      <div class="header-left">
        <img
          src="https://agcdn.altametrics.com/hw_prod_others/common/images/app_icon/zipclock.svg"
          class="app-logo"
        />
        <div class="nav-link">
          <i class="bi bi-grid-3x3-gap-fill"></i> My App
          <i class="bi bi-caret-down-fill" style="font-size: 8px"></i>
        </div>
        <div class="nav-link"><i class="bi bi-house-door"></i> Dashboard</div>
        <div class="nav-link">
          <i class="bi bi-clock-history"></i> Site Clock
        </div>
        <div class="nav-link">
          <i class="bi bi-geo-alt"></i> 99999
          <i class="bi bi-caret-down-fill" style="font-size: 8px"></i>
        </div>
      </div>
      <div class="header-center">
        <div class="weather">
          <i class="bi bi-cloud-snow"></i><span>-6Â°C</span>
        </div>
        <div class="time-box">
          <b>10:25</b><sup>A</sup><span>America/Toronto</span>
        </div>
      </div>
      <div class="header-right">
        <div class="store-tag"><i class="bi bi-shop"></i> 99999</div>
        <i class="bi bi-moon" style="margin-left: 10px; cursor: pointer"></i>
        <i class="bi bi-gear" style="margin-left: 10px; cursor: pointer"></i>
        <i
          class="bi bi-person-circle"
          style="margin-left: 10px; cursor: pointer"
        ></i>
      </div>
    </header>
    <aside class="sidebar">
      <ul class="menu-list">
        <li>
          <a href="index.html" class="menu-item"
            ><i class="bi bi-house-door"></i
            ><span class="menu-label">Dashboard</span></a
          >
        </li>
        <li>
          <a href="Site-Clock.html" class="menu-item active"
            ><i class="bi bi-clock"></i
            ><span class="menu-label">Site Clock</span></a
          >
        </li>
        <li>
          <a href="#" class="menu-item"
            ><i class="bi bi-calendar-check"></i
            ><span class="menu-label">Punch Management</span></a
          >
        </li>
        <li>
          <a href="Payroll-Management.html" class="menu-item"
            ><i class="bi bi-wallet2"></i
            ><span class="menu-label">Payroll Management</span></a
          >
        </li>
        <li>
          <a href="#" class="menu-item" onclick="showTimeLossSummary(this)">
            <i class="bi bi-graph-down-arrow"></i>
            <span class="menu-label">Time Loss Summary</span>
          </a>
        </li>
        <li>
          <a href="#" class="menu-item"
            ><i class="bi bi-file-earmark-bar-graph"></i
            ><span class="menu-label">Reports</span></a
          >
        </li>
        <li>
          <a href="#" class="menu-item"
            ><i class="bi bi-clock"></i
            ><span class="menu-label">Time Clock Devices</span></a
          >
        </li>
        <li>
          <a href="#" class="menu-item"
            ><i class="bi bi-people"></i
            ><span class="menu-label">Employees</span></a
          >
        </li>
      </ul>
      <div class="sidebar-footer">
        <div class="settings-circle"><i class="bi bi-gear"></i></div>
        <div class="help-main">Help</div>
      </div>
    </aside>
    <main class="main-content">
      <div id="dynamicContent"></div>
      <div id="siteClockContent">
        <div class="status-row">
          <div
            class="status-tab tab-clocked active"
            onclick="switchTab('clocked', this)"
          >
            <h2 id="count-clocked">4</h2>
            <p>Employee(s) Clocked In</p>
          </div>
          <div class="status-tab tab-break" onclick="switchTab('break', this)">
            <h2 id="count-break">2</h2>
            <p>Employee(s) on Break</p>
          </div>
          <div
            class="status-tab tab-missing"
            onclick="switchTab('missing', this)"
          >
            <h2 id="count-missing">8</h2>
            <p>Employee(s) Missing</p>
          </div>
        </div>
        <div class="kpi-row">
          <div class="kpi-card">
            <div class="kpi-header">
              <div class="kpi-title-group">
                <div
                  class="kpi-icon-box"
                  style="background: #e0e7ff; color: #4338ca"
                >
                  <i class="bi bi-clock"></i>
                </div>
                <span class="kpi-name">Employees On Clock</span>
              </div>
              <i
                class="bi bi-bar-chart-line kpi-mini-graph"
                onclick="openTileIntel('Clocked In')"
              ></i>
            </div>
            <div class="kpi-main-val">
              <span class="kpi-number" id="kpi-clocked-in">18</span>
              <span class="kpi-badge badge-pos"
                ><i class="bi bi-arrow-up"></i> +2 since last hour</span
              >
            </div>
            <div class="kpi-footer">
              <div class="footer-item">
                <span class="footer-label">On Break</span
                ><span class="footer-value">4</span>
              </div>
              <div class="footer-item">
                <span class="footer-label">Near Break</span
                ><span class="footer-value">6</span>
              </div>
            </div>
          </div>
          <div class="kpi-card">
            <div class="kpi-header">
              <div class="kpi-title-group">
                <div
                  class="kpi-icon-box"
                  style="background: #fef3c7; color: #d97706"
                >
                  <i class="bi bi-lightning-charge"></i>
                </div>
                <span class="kpi-name">Labor Efficiency</span>
              </div>
              <i
                class="bi bi-bar-chart-line kpi-mini-graph"
                onclick="openTileIntel('Efficiency')"
              ></i>
            </div>
            <div class="kpi-main-val">
              <span class="kpi-number">92.4%</span>
              <span class="kpi-badge badge-pos"
                ><i class="bi bi-arrow-up"></i> +4.2% vs Plan</span
              >
            </div>
            <div class="kpi-footer">
              <div class="footer-item">
                <span class="footer-label">Act Hours</span
                ><span class="footer-value">142.5h</span>
              </div>
              <div class="footer-item">
                <span class="footer-label">Sch Hours</span
                ><span class="footer-value">154.2h</span>
              </div>
            </div>
          </div>
          <div class="kpi-card">
            <div class="kpi-header">
              <div class="kpi-title-group">
                <div
                  class="kpi-icon-box"
                  style="background: #f3e8ff; color: #7e22ce"
                >
                  <i class="bi bi-pencil-square"></i>
                </div>
                <span class="kpi-name">Punch Exceptions</span>
              </div>
              <i
                class="bi bi-bar-chart-line kpi-mini-graph"
                onclick="openTileIntel('Exceptions')"
              ></i>
            </div>
            <div class="kpi-main-val">
              <span class="kpi-number">14</span>
              <span class="kpi-badge badge-neg"
                ><i class="bi bi-arrow-down"></i> -3 today</span
              >
            </div>
            <div class="kpi-footer">
              <div class="footer-item">
                <span class="footer-label">Missed In/Out</span
                ><span class="footer-value">11</span>
              </div>
              <div class="footer-item">
                <span class="footer-label">Oldest</span
                ><span class="footer-value">2h 35m</span>
              </div>
            </div>
          </div>
          <div class="kpi-card">
            <div class="kpi-header">
              <div class="kpi-title-group">
                <div
                  class="kpi-icon-box"
                  style="background: #dcfce7; color: #15803d"
                >
                  <i class="bi bi-cup-hot"></i>
                </div>
                <span class="kpi-name">Break Compliance</span>
              </div>
              <i
                class="bi bi-bar-chart-line kpi-mini-graph"
                onclick="openTileIntel('Breaks')"
              ></i>
            </div>
            <div class="kpi-main-val">
              <span class="kpi-number">5</span>
              <span class="kpi-badge badge-pos"
                ><i class="bi bi-arrow-up"></i> +1 last 30m</span
              >
            </div>
            <div class="kpi-footer">
              <div class="footer-item">
                <span class="footer-label">Next Due</span
                ><span class="footer-value">18m</span>
              </div>
              <div class="footer-item">
                <span class="footer-label">Overdue</span
                ><span class="footer-value val-danger">1</span>
              </div>
            </div>
          </div>
          <div class="kpi-card">
            <div class="kpi-header">
              <div class="kpi-title-group">
                <div
                  class="kpi-icon-box"
                  style="background: #fee2e2; color: #b91c1c"
                >
                  <i class="bi bi-exclamation-triangle"></i>
                </div>
                <span class="kpi-name">Overtime Risk</span>
              </div>
              <i
                class="bi bi-bar-chart-line kpi-mini-graph"
                onclick="openTileIntel('OT Risk')"
              ></i>
            </div>
            <div class="kpi-main-val">
              <span class="kpi-number">6</span>
              <span class="kpi-badge badge-pos"
                ><i class="bi bi-arrow-up"></i> +2 this week</span
              >
            </div>
            <div class="kpi-footer">
              <div class="footer-item">
                <span class="footer-label">Next OT In</span
                ><span class="footer-value">2h 15m</span>
              </div>
              <div class="footer-item">
                <span class="footer-label">38h+ Staff</span
                ><span class="footer-value">3</span>
              </div>
            </div>
          </div>
        </div>
        <div class="tool-bar">
          <button class="btn-advanced" onclick="window.print()">
            <i class="bi bi-printer"></i> Print
          </button>
          <button class="btn-advanced">
            <i class="bi bi-download"></i> CSV
          </button>
          <button class="btn-advanced btn-intel" onclick="openCommandCenter()">
            <i class="bi bi-stars"></i> Intelligence Center
          </button>
        </div>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>
                  <div style="display: flex; align-items: center; gap: 5px">
                    Employees
                    <i class="bi bi-arrow-down-up" style="font-size: 10px"></i>
                    <i class="bi bi-search" style="font-size: 10px"></i>
                  </div>
                </th>
                <th style="text-align: center">Start Shift</th>
                <th style="text-align: center">OT</th>
                <th style="text-align: center">Minor</th>
                <th style="text-align: center">ACA</th>
                <th style="text-align: center">Break</th>
                <th style="text-align: center">EOS</th>
                <th style="text-align: center">Proj OT</th>
              </tr>
            </thead>
            <tbody id="emp-list"></tbody>
          </table>
        </div>
      </div>
    </main>
    <div class="modal-overlay" id="intelModal">
      <div class="modal-content">
        <div class="modal-header">
          <span id="modal-title" style="font-weight: 700; font-size: 14px"
            >Intelligence Center</span
          >
          <i
            class="bi bi-x-lg"
            style="cursor: pointer"
            onclick="closeModal()"
          ></i>
        </div>
        <div class="modal-tabs" id="modal-tab-bar"></div>
        <div class="modal-body" id="modal-body-content"></div>
      </div>
    </div>
    <script>
      const ICON_MAP = {
        "green-smile":
          '<i class="bi bi-emoji-smile-fill icon-green-smile"></i>',
        "orange-straight":
          '<i class="bi bi-emoji-neutral-fill icon-orange-straight"></i>',
        "orange-sad": '<i class="bi bi-emoji-frown-fill icon-orange-sad"></i>',
        "red-sad": '<i class="bi bi-emoji-frown-fill icon-red-sad"></i>',
        "blue-question":
          '<i class="bi bi-question-circle-fill icon-blue-question"></i>',
        "grey-empty": '<i class="bi bi-circle icon-grey-empty"></i>',
        "timer-12": '<div class="timer-badge-red">12</div>',
        "timer-05": '<div class="timer-badge-red">05</div>',
      };

      const store = {
        clocked: [
          {
            name: "Andrew Garcia",
            sch: "4:00a-4:00p",
            av: "AG",
            bg: "#f59e0b",
            icons: [
              "red-sad",
              "grey-empty",
              "grey-empty",
              "grey-empty",
              "grey-empty",
              "green-smile",
              "green-smile",
            ],
          },
          {
            name: "Christopher Anderson",
            sch: "8:00a-4:00p",
            av: "CA",
            bg: "#3b82f6",
            icons: [
              "grey-empty",
              "green-smile",
              "grey-empty",
              "grey-empty",
              "green-smile",
              "grey-empty",
              "grey-empty",
            ],
          },
          {
            name: "Brian Johnson",
            sch: "9:00a-5:00p",
            av: "BJ",
            bg: "#10b981",
            icons: [
              "green-smile",
              "timer-12",
              "grey-empty",
              "grey-empty",
              "orange-straight",
              "grey-empty",
              "grey-empty",
            ],
          },
          {
            name: "Sarah Williams",
            sch: "10:00a-6:00p",
            av: "SW",
            bg: "#7e22ce",
            icons: [
              "green-smile",
              "green-smile",
              "grey-empty",
              "grey-empty",
              "orange-sad",
              "green-smile",
              "orange-sad",
            ],
          },
        ],
        break: [
          {
            name: "Andrew Garcia",
            sch: "4:00a-4:00p",
            av: "AG",
            bg: "#f59e0b",
            icons: [
              "red-sad",
              "grey-empty",
              "grey-empty",
              "grey-empty",
              "grey-empty",
              "green-smile",
              "green-smile",
            ],
            timer: "00:18",
          },
          {
            name: "Michael Chen",
            sch: "11:00a-7:00p",
            av: "MC",
            bg: "#06b6d4",
            icons: [
              "green-smile",
              "grey-empty",
              "grey-empty",
              "grey-empty",
              "green-smile",
              "green-smile",
              "grey-empty",
            ],
            timer: "00:05",
          },
        ],
        missing: [
          {
            name: "Andrew Gonzalez",
            sch: "4:00a-4:00p",
            av: "AG",
            bg: "#06b6d4",
            icons: [
              "blue-question",
              "grey-empty",
              "grey-empty",
              "grey-empty",
              "grey-empty",
              "grey-empty",
              "grey-empty",
            ],
          },
          {
            name: "David Miller",
            sch: "12:00p-8:00p",
            av: "DM",
            bg: "#3b82f6",
            icons: [
              "grey-empty",
              "grey-empty",
              "grey-empty",
              "grey-empty",
              "grey-empty",
              "grey-empty",
              "grey-empty",
            ],
          },
        ],
      };

      let myChart = null;

      // --- Tile-Specific Intelligence (Bar, Pie, Trend, Table, Insights) ---
      function openTileIntel(context) {
        document.getElementById("modal-title").innerText =
          context + " Diagnostic Intelligence";
        const tabs = ["Trend", "Bar", "Pie", "Table", "Insights"];
        const tabContainer = document.getElementById("modal-tab-bar");

        // Pass the 'context' string into every onclick call
        tabContainer.innerHTML = tabs
          .map(
            (t, i) =>
              `<div class="modal-tab ${i === 0 ? "active" : ""}" onclick="switchTileTab('${t.toLowerCase()}', this, '${context}')">${t}</div>`,
          )
          .join("");

        document.getElementById("intelModal").style.display = "flex";
        // Initialize the first tab with the context
        switchTileTab("trend", tabContainer.firstChild, context);
      }

      function switchTileTab(type, el, context) {
        document
          .querySelectorAll(".modal-tab")
          .forEach((t) => t.classList.remove("active"));
        el.classList.add("active");
        const body = document.getElementById("modal-body-content");

        // Data Mapping per KPI
        const dataRepo = {
          "Clocked In": {
            vals: [7, 11, 18, 20, 16, 10],
            peak: "12 PM",
            avg: "13.7",
            note: "Peak overlap at noon.",
          },
          Efficiency: {
            vals: [82, 85, 92, 94, 90, 88],
            peak: "12 PM",
            avg: "88.5%",
            note: "Optimal during lunch.",
          },
          Exceptions: {
            vals: [2, 8, 3, 1, 5, 2],
            peak: "8 AM",
            avg: "3.5",
            note: "High risk during clock-in.",
          },
          Breaks: {
            vals: [0, 1, 5, 8, 4, 2],
            peak: "12 PM",
            avg: "3.3",
            note: "High break volume now.",
          },
          "OT Risk": {
            vals: [1, 1, 2, 4, 6, 8],
            peak: "4 PM",
            avg: "3.6",
            note: "Risk increases at EOS.",
          },
        };

        const current = dataRepo[context] || dataRepo["Clocked In"];
        const times = ["6 AM", "8 AM", "10 AM", "12 PM", "2 PM", "4 PM"];

        if (type === "insights") {
          body.innerHTML = `
			    <div class="ai-report-card">
			        <div style="display:flex; gap:15px; margin-bottom:20px;">
			            <div style="flex:1; background:#eff6ff; padding:15px; border-radius:8px;">
			                <small style="color:#2563eb; font-weight:700;">PEAK ${context.toUpperCase()}</small>
			                <h2 style="margin-top:5px;">${current.peak}</h2>
			            </div>
			            <div style="flex:1; background:#f0fdf4; padding:15px; border-radius:8px;">
			                <small style="color:#16a34a; font-weight:700;">AVERAGE</small>
			                <h2 style="margin-top:5px;">${current.avg}</h2>
			            </div>
			        </div>
			        <div class="recommendation-box">
			            <i class="bi bi-lightbulb-fill" style="color:#d97706;"></i>
			            <p style="font-size:12px; color:#92400e;"><strong>Note:</strong> ${current.note}</p>
			        </div>
			    </div>`;
        } else if (type === "table") {
          body.innerHTML = `<table>
			    <thead><tr><th>Time</th><th>Value</th></tr></thead>
			    <tbody>${times.map((t, i) => `<tr><td>${t}</td><td>${current.vals[i]}</td></tr>`).join("")}</tbody>
			</table>`;
        } else {
          body.innerHTML = `<div style="height:350px;"><canvas id="tileChart"></canvas></div>`;
          const formattedData = times.map((t, i) => ({
            time: t,
            val: current.vals[i],
          }));
          setTimeout(() => renderTileChart(type, context, formattedData), 10);
        }
      }

      function renderTileChart(type, context, rawData) {
        if (myChart) myChart.destroy();
        const ctx = document.getElementById("tileChart").getContext("2d");

        const colors = [
          "#3b82f6",
          "#10b981",
          "#f59e0b",
          "#ef4444",
          "#8b5cf6",
          "#06b6d4",
        ];

        myChart = new Chart(ctx, {
          type: type === "trend" ? "line" : type === "bar" ? "bar" : "doughnut",
          data: {
            labels: rawData.map((d) => d.time),
            datasets: [
              {
                label: "Value",
                data: rawData.map((d) => d.val),
                backgroundColor:
                  type === "bar"
                    ? colors
                    : type === "trend"
                      ? "rgba(59, 130, 246, 0.1)"
                      : colors,
                borderColor: "#3b82f6",
                borderWidth: type === "trend" ? 3 : 0,
                fill: true,
                tension: 0.4,
                borderRadius: type === "bar" ? 6 : 0,
                cutout: type === "pie" ? "60%" : 0,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: type === "pie" || type === "trend",
                position: "bottom",
              },
            },
          },
        });
      }

      // --- RESTORED COMMAND CENTER (Intelligence Center Button) ---
      function openCommandCenter() {
        document.getElementById("modal-title").innerText =
          "Advanced Command Intelligence Center";
        const tabContainer = document.getElementById("modal-tab-bar");
        const tabs = [
          "Overview",
          "Labor Forecast",
          "Compliance Audit",
          "Risk Map",
        ];

        tabContainer.innerHTML = tabs
          .map(
            (t, i) =>
              `<div class="modal-tab ${i === 0 ? "active" : ""}" onclick="switchCommandTab('${t}', this)">${t}</div>`,
          )
          .join("");

        document.getElementById("intelModal").style.display = "flex";
        switchCommandTab("Overview", tabContainer.firstChild);
      }

      function renderHeatmap() {
        if (myChart) myChart.destroy();
        const ctx = document.getElementById("heatmapChart").getContext("2d");
        myChart = new Chart(ctx, {
          type: "bar",
          data: {
            labels: ["6a", "9a", "12p", "3p", "6p"],
            datasets: [
              {
                label: "Labor Cost",
                data: [15, 25, 40, 35, 20],
                backgroundColor: "#8b5cf6",
              },
            ],
          },
          options: { responsive: true, maintainAspectRatio: false },
        });
      }

      function closeModal() {
        document.getElementById("intelModal").style.display = "none";
      }

      function switchTab(tab, el) {
        document
          .querySelectorAll(".status-tab")
          .forEach((t) => t.classList.remove("active"));
        el.classList.add("active");
        renderList(store[tab]);
      }

      function renderList(data) {
        const list = document.getElementById("emp-list");
        list.innerHTML = data
          .map(
            (emp) => `<tr>
			<td>
			    <div class="emp-profile" onclick="openEmployeeDetails('${emp.name}', event)" style="cursor:pointer; display: flex; align-items: center; gap: 10px; width: fit-content;">
			        <div class="avatar" style="background:${emp.bg}">${emp.av}</div>
			        <div>
			            <div style="font-weight:600; color:#2563eb;">${emp.name}</div>
			            <div style="font-size:10px; color:#64748b;">Sch ${emp.sch}</div>
			        </div>
			    </div>
			</td>
			${emp.icons.map((ic) => `<td align="center"><div class="status-cell">${ICON_MAP[ic] || ICON_MAP["grey-empty"]}</div></td>`).join("")}
			</tr>`,
          )
          .join("");
      }

      // Init
      switchTab("clocked", document.querySelector(".status-tab"));

      function switchCommandTab(tabName, el) {
        document
          .querySelectorAll(".modal-tab")
          .forEach((t) => t.classList.remove("active"));
        el.classList.add("active");
        const body = document.getElementById("modal-body-content");

        // Shared style for horizontal alignment of Icon + Title
        const headerStyle = `display: flex; align-items: center; gap: 12px; margin-bottom: 20px;`;
        const iconBoxStyle = `margin-bottom: 0; flex-shrink: 0;`; // Resets bottom margin and prevents squishing
        const titleStyle = `font-size: 15px; color: #1e293b; margin: 0; font-weight: 700;`;

        if (tabName === "Overview") {
          body.innerHTML = `
			    <div class="intel-grid">
			        <div class="intel-card">
			            <div style="${headerStyle}">
			                <div class="premium-icon-box" style="background: #eef2ff; color: #4f46e5; ${iconBoxStyle}">
			                    <i class="bi bi-cpu"></i>
			                </div>
			                <h4 style="${titleStyle}">Real-time Labor Heatmap</h4>
			            </div>
			            <div style="height: 200px;"><canvas id="cmdChart"></canvas></div>
			        </div>
			        <div class="intel-card">
			            <div style="${headerStyle}">
			                <div class="premium-icon-box" style="background: #fef2f2; color: #dc2626; ${iconBoxStyle}">
			                    <i class="bi bi-shield-check"></i>
			                </div>
			                <h4 style="${titleStyle}">Executive Summary</h4>
			            </div>
			            <div class="insight-item" style="border-left-color: #ef4444;">
			                <i class="bi bi-exclamation-octagon-fill" style="margin-right:8px; color:#ef4444"></i>
			                <strong>Overtime:</strong> 3 staff members exceeding 38h/week.
			            </div>
			            <div class="insight-item" style="border-left-color: #10b981;">
			                <i class="bi bi-check-circle-fill" style="margin-right:8px; color:#10b981"></i>
			                <strong>Efficiency:</strong> Current labor vs sales +4.2% vs target.
			            </div>
			        </div>
			    </div>`;
          setTimeout(
            () =>
              renderCmdChart(
                "bar",
                [15, 25, 40, 35, 20],
                ["6a", "9a", "12p", "3p", "6p"],
                "#6366f1",
              ),
            50,
          );
        } else if (tabName === "Labor Forecast") {
          body.innerHTML = `
			    <div class="intel-card">
			        <div style="${headerStyle}">
			            <div class="premium-icon-box" style="background: #f0fdf4; color: #16a34a; ${iconBoxStyle}">
			                <i class="bi bi-graph-up-arrow"></i>
			            </div>
			            <h4 style="${titleStyle}">Smart Forecasting (24h)</h4>
			        </div>
			        <div style="height: 220px;"><canvas id="cmdChart"></canvas></div>
			        <div class="recommendation-box" style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius:12px; padding: 15px; margin-top:20px;">
			            <div style="display:flex; align-items:center; gap:12px;">
			                <div style="background:#6366f1; color:white; padding:8px; border-radius:8px;"><i class="bi bi-lightbulb"></i></div>
			                <p style="font-size:12px; color:#475569;"><strong>AI Suggestion:</strong> Shift coverage is heavy between 2pm-4pm. We recommend reallocating 2.5 hours to the dinner peak.</p>
			            </div>
			        </div>
			    </div>`;
          setTimeout(
            () =>
              renderCmdChart(
                "line",
                [22, 28, 45, 32, 58, 42],
                ["12p", "2p", "4p", "6p", "8p", "10p"],
                "#10b981",
              ),
            50,
          );
        } else if (tabName === "Compliance Audit") {
          body.innerHTML = `
			    <div class="intel-card">
			        <div style="${headerStyle}">
			            <div class="premium-icon-box" style="background: #fff7ed; color: #ea580c; ${iconBoxStyle}">
			                <i class="bi bi-clipboard-data"></i>
			            </div>
			            <h4 style="${titleStyle}">Detailed Compliance Log</h4>
			        </div>
			        <div style="display:grid; gap:12px;">
			            ${[
                    "Missed Break: Garcia, A.",
                    "Early Clock-in: Williams, S.",
                    "Violation: Chen, M.",
                  ]
                    .map(
                      (txt) => `
			                <div style="display:flex; justify-content:space-between; align-items:center; padding:12px; border-bottom:1px solid #f1f5f9;">
			                    <div style="display:flex; align-items:center; gap:10px;">
			                        <i class="bi bi-dot" style="font-size:24px; color:#ef4444"></i>
			                        <span style="font-size:13px; font-weight:500;">${txt}</span>
			                    </div>
			                    <button style="border:none; background:#eff6ff; color:#2563eb; font-size:11px; padding:4px 12px; border-radius:6px; cursor:pointer;">Review</button>
			                </div>
			            `,
                    )
                    .join("")}
			        </div>
			    </div>`;
        } else if (tabName === "Risk Map") {
          body.innerHTML = `
			    <div class="intel-grid">
			        <div class="intel-card" style="grid-column: span 2;">
			            <div style="${headerStyle}">
			                <div class="premium-icon-box" style="background: #faf5ff; color: #9333ea; ${iconBoxStyle}">
			                    <i class="bi bi-radar"></i>
			                </div>
			                <h4 style="${titleStyle}">Advanced Risk Analysis</h4>
			            </div>
			            <div style="height: 250px;"><canvas id="cmdChart"></canvas></div>
			        </div>
			    </div>`;
          setTimeout(
            () =>
              renderCmdChart(
                "radar",
                [85, 45, 95, 75, 60],
                ["OT Risk", "Fatigue", "Legal", "Sales-to-Labor", "Retention"],
                "#9333ea",
              ),
            50,
          );
        }
      }

      // Helper to render any chart inside the Command Center
      function renderCmdChart(type, data, labels, color) {
        if (myChart) myChart.destroy();
        const ctx = document.getElementById("cmdChart").getContext("2d");
        myChart = new Chart(ctx, {
          type: type,
          data: {
            labels: labels,
            datasets: [
              {
                label: "System Metrics",
                data: data,
                backgroundColor: type === "line" ? "transparent" : color,
                borderColor: color,
                tension: 0.4,
                fill: true,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
          },
        });
      }

      function openEmployeeDetails(empName, event) {
        event.stopPropagation();

        const existing = document.getElementById("emp-popover-container");
        if (existing) existing.remove();

        // Data Mapping from screenshots
        const empData = {
          name: empName,
          sch: empName.includes("Andrew") ? "4:00a-4:00p" : "No Schedule",
          clockIn: empName.includes("Andrew")
            ? "04:47a (DOUGH)"
            : "05:04a (Crew)",
          weekly: empName.includes("Andrew") ? "00:09" : "00:00",
          daily: empName.includes("Andrew") ? "02:32" : "02:03",
          toOT: empName.includes("Andrew") ? "23:51" : "N/A",
          toACA: "N/A",
          otHours: "00:00",
          remSch: empName.includes("Andrew") ? "16:00" : "00:00",
        };

        const container = document.createElement("div");
        container.id = "emp-popover-container";

        const rect = event.currentTarget.getBoundingClientRect();
        container.style.top = rect.top + window.scrollY - 20 + "px";
        container.style.left = rect.right + 15 + "px";

        container.innerHTML = `
			<div class="modern-popover">
			    <div class="pop-arrow"></div>
			    <div class="pop-header-main">
			        <span class="emp-name-title">${empData.name}</span>
			        <button class="close-pop-btn" onclick="document.getElementById('emp-popover-container').remove()">
			            <i class="bi bi-x-lg"></i>
			        </button>
			    </div>
			    
			    <div class="pop-sub-header">
			        <div class="info-group">
			            <label>Scheduled:</label>
			            <span>${empData.sch}</span>
			        </div>
			        <div class="info-group">
			            <label>Clock In:</label>
			            <span>${empData.clockIn}</span>
			        </div>
			    </div>
			
			    <div class="pop-action-container">
			        ${empData.sch === "No Schedule" ? '<button class="action-pill pill-blue">Suggest Break</button>' : ""}
			        <button class="action-pill pill-cyan">Suggest Clock Out</button>
			    </div>
			
			    <div class="pop-metrics-grid">
			        <div class="metric-item"><label>Actual Weekly Hours</label> <span>${empData.weekly}</span></div>
			        <div class="metric-item"><label>Actual Daily Hours</label> <span>${empData.daily}</span></div>
			        <div class="metric-item"><label>Projected Hours to OT</label> <span>${empData.toOT}</span></div>
			        <div class="metric-item"><label>Projected Hours to ACA</label> <span>${empData.toACA}</span></div>
			        <div class="metric-item"><label>Overtime Hours</label> <span>${empData.otHours}</span></div>
			        <div class="metric-item"><label>Remaining Scheduled Hours</label> <span>${empData.remSch}</span></div>
			    </div>
			</div>
			`;

        document.body.appendChild(container);

        setTimeout(() => {
          const closeHandler = (e) => {
            if (!container.contains(e.target)) {
              container.remove();
              window.removeEventListener("mousedown", closeHandler);
            }
          };
          window.addEventListener("mousedown", closeHandler);
        }, 10);
      }

      function showTimeLossSummary(el) {
        // Sidebar active state
        document
          .querySelectorAll(".menu-item")
          .forEach((i) => i.classList.remove("active"));
        el.classList.add("active");

        // Hide Site Clock content
        document.getElementById("siteClockContent").style.display = "none";

        // Full-screen image view
        document.getElementById("dynamicContent").innerHTML = `
			<div class="time-loss-fullscreen">
			    <img src="Time-Loss.png" alt="Time Loss Summary" />
			</div>
			`;
      }
    </script>
  </body>
</html>
